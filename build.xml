<project name="oxdoc" default="jar" basedir=".">

  <description>Ant build file for oxdoc</description>

  <property file="build.properties"/>

  <property name="version" value="0.85alpha"/>

  <property name="src"     location="src"/>
  <property name="srcmisc" location="src/misc"/>
  <property name="bin"     location="bin"/>
  <property name="parser"  location="src/parser" />
  <property name="build"   location="build"/>
  <property name="distbin" location="dist/bin"/>
  <property name="dist"    location="dist"/>
  <property name="docs"    location="docs"/>
  <property name="zips"    location="zips"/>


  <property name="distbinzip" value="${zips}/oxdoc-${version}-bin" />
  <property name="distsrczip" value="${zips}/oxdoc-${version}-src" />


  <target name="clean">
    <delete dir="${bin}"/>
    <delete dir="${build}"/>
    <delete dir="${parser}"/>
    <delete dir="${zips}"/>
  </target>


  <target name="parser">
     <mkdir dir="${parser}"/>
     <javacc target="${src}/ox.jj" outputdirectory="${parser}"
      javacchome="${javacc}"
      debuglookahead="false"
      debugparser="false"
      static="false" />
  </target>


  <target name="doc" depends="parser">
    <javadoc packagenames="*"
           defaultexcludes="yes"
           destdir="${docs}"
           use="true"
           stylesheetfile="${src}/javadoc.css"
           windowtitle="oxdoc Development Documentation">
      <fileset dir="src" defaultexcludes="yes">
        <include name="**/*.java" />
      </fileset>
    </javadoc>
  </target>


  <target name="compile" depends="parser">
     <mkdir dir="${build}"/>
     <javac srcdir="${src}/WriteConstants" destdir="${build}" nowarn="on" debug="${debug}" />
     <java classname="WriteConstants" classpath="${build}" output="${parser}/Constants.java">
         <arg value="${version}" />
     </java>
     <delete file="${build}/Constants.class"/>
     <javac srcdir="${src}" destdir="${build}" nowarn="on" debug="${debug}" />
  </target>


  <target name="jar" depends="compile">
    <mkdir dir="${bin}"/>
    <copy file="${srcmisc}/oxdoc.css" todir="${build}" />
    <copy file="${srcmisc}/oxdoc.xml" todir="${bin}"  />
    <jar jarfile="${bin}/oxdoc.jar" basedir="${build}" />
  </target>

  <target name="dist" depends="distbin,distsrc">
  </target>


  <target name="distbin" depends="jar,distsrc">
    <mkdir dir="${distbin}"/>
    <mkdir dir="${zips}"/>

    <copy file="README" todir="${dist}"/>
    <copy file="LICENSE" todir="${dist}"/>
    <copy file="${srcmisc}/oxdoc.xml" todir="${distbin}"/>
    <copy file="${srcmisc}/oxdoc" todir="${distbin}"  />
    <copy file="${srcmisc}/oxdoc.bat" todir="${distbin}"  />
    <copy file="${bin}/oxdoc.jar" todir="${distbin}"/>

    <zip destfile="${distbinzip}.zip" basedir="${dist}" />
    <tar destfile="${distbinzip}.tgz" basedir="${dist}" compression="gzip" />
  </target>


  <target name="distsrc" depends="doc">
    <mkdir dir="${zips}"/>
    <zip destfile="${distsrczip}.zip">
      <zipfileset dir="${src}" prefix="src/" defaultexcludes="yes" excludes="parser/**" />
      <zipfileset dir="${docs}" prefix="docs/" />
      <zipfileset dir="./" includes="build.xml,oxdoc.xml.template,build.properties.template" />
    </zip>
    <tar destfile="${distsrczip}.tgz" basedir="./" compression="gzip">
      <tarfileset dir="${src}" prefix="src/" defaultexcludes="yes" excludes="parser/**" />
      <tarfileset dir="${docs}" prefix="docs/" />
      <tarfileset dir="./" includes="build.xml,oxdoc.xml.template,build.properties.template" />
    </tar>
  </target>

  
  <target name="all" depends="clean,dist" />


</project>
